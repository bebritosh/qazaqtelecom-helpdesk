{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<section class="stripe-section" style="padding-top: 3rem; padding-bottom: 3rem;">
  <div class="container" style="max-width: 1200px;">
    <!-- Header -->
    <div class="text-center mb-5 animate-fade-in-up">
      <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; letter-spacing: -0.02em;">
        База знаний
      </h1>
      <p style="font-size: 1.125rem; color: var(--kt-text-light); max-width: 640px; margin: 0 auto;">
        Найдите ответы на часто задаваемые вопросы и решения типовых проблем
      </p>
    </div>

    <!-- Search Bar -->
    <div class="stripe-card mb-4 animate-fade-in-up" style="animation-delay: 0.1s;">
      <form method="get" action="{% url 'knowledge:list' %}">
        <div class="row g-3">
          <div class="col-md-8">
            <div class="input-group">
              <span class="input-group-text" style="background: var(--kt-surface); border-color: var(--kt-border);">
                <i class="bi bi-search"></i>
              </span>
              <input type="text" name="q" class="form-control" placeholder="Поиск по базе знаний..." value="{{ query }}" style="border-color: var(--kt-border);">
            </div>
          </div>
          <div class="col-md-3">
            <select name="category" class="form-select" style="border-color: var(--kt-border);">
              <option value="">Все категории</option>
              {% for cat_value, cat_name in categories %}
                <option value="{{ cat_value }}" {% if category == cat_value %}selected{% endif %}>{{ cat_name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-md-1">
            <button type="submit" class="btn btn-primary w-100">
              <i class="bi bi-search"></i>
            </button>
          </div>
        </div>
      </form>
    </div>

    <div class="row g-4">
      <!-- Main Content -->
      <div class="col-lg-8">
        {% if articles %}
          {% for article in articles %}
            <div class="stripe-card mb-3 animate-fade-in-up" style="animation-delay: {{ forloop.counter|add:1|stringformat:'d' }}00ms;">
              <a href="{% url 'knowledge:detail' article.slug %}" style="text-decoration: none; color: inherit; display: block;">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h3 style="font-size: 1.25rem; font-weight: 600; margin: 0; color: var(--kt-text);">
                    {{ article.title }}
                  </h3>
                  <span class="badge" style="background-color: rgba(0,174,239,0.1); color: var(--kt-accent); font-weight: 500;">
                    {{ article.get_category_display }}
                  </span>
                </div>
                <p style="color: var(--kt-text-light); margin-bottom: 1rem;">
                  {{ article.summary }}
                </p>
                <div class="d-flex gap-3 align-items-center" style="font-size: 0.875rem; color: var(--kt-text-light);">
                  <span><i class="bi bi-eye me-1"></i>{{ article.views_count }} просмотров</span>
                  <span><i class="bi bi-hand-thumbs-up me-1"></i>{{ article.helpful_count }} полезно</span>
                  {% if article.get_tags_list %}
                    <div class="d-flex gap-1 flex-wrap">
                      {% for tag in article.get_tags_list %}
                        <span class="badge bg-secondary">{{ tag }}</span>
                      {% endfor %}
                    </div>
                  {% endif %}
                </div>
              </a>
            </div>
          {% endfor %}
        {% else %}
          <div class="stripe-card text-center" style="padding: 3rem;">
            <i class="bi bi-search" style="font-size: 3rem; color: var(--kt-text-light); margin-bottom: 1rem;"></i>
            <h3 style="color: var(--kt-text-light);">Статьи не найдены</h3>
            <p style="color: var(--kt-text-light);">Попробуйте изменить поисковый запрос</p>
          </div>
        {% endif %}
      </div>

      <!-- Sidebar -->
      <div class="col-lg-4">
        <!-- Popular Articles -->
        <div class="stripe-card mb-4 animate-fade-in-up" style="animation-delay: 0.2s;">
          <h4 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--kt-text);">
            Популярные статьи
          </h4>
          <div class="d-flex flex-column gap-2">
            {% for article in popular_articles %}
              <a href="{% url 'knowledge:detail' article.slug %}" style="text-decoration: none; color: var(--kt-text); padding: 0.5rem; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='var(--kt-surface)'" onmouseout="this.style.background='transparent'">
                <div style="font-weight: 500; font-size: 0.9375rem;">{{ article.title }}</div>
                <div style="font-size: 0.8125rem; color: var(--kt-text-light);">
                  <i class="bi bi-eye me-1"></i>{{ article.views_count }}
                </div>
              </a>
            {% endfor %}
          </div>
        </div>

        <!-- Helpful Articles -->
        <div class="stripe-card animate-fade-in-up" style="animation-delay: 0.3s;">
          <h4 style="font-size: 1rem; font-weight: 600; margin-bottom: 1rem; color: var(--kt-text);">
            Самые полезные
          </h4>
          <div class="d-flex flex-column gap-2">
            {% for article in helpful_articles %}
              <a href="{% url 'knowledge:detail' article.slug %}" style="text-decoration: none; color: var(--kt-text); padding: 0.5rem; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='var(--kt-surface)'" onmouseout="this.style.background='transparent'">
                <div style="font-weight: 500; font-size: 0.9375rem;">{{ article.title }}</div>
                <div style="font-size: 0.8125rem; color: var(--kt-text-light);">
                  <i class="bi bi-hand-thumbs-up me-1"></i>{{ article.helpfulness_score }}% полезно
                </div>
              </a>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
