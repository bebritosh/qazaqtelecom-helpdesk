{% extends 'core/base.html' %}

{% block content %}
<section class="stripe-section" style="padding-top: 3rem; padding-bottom: 3rem;">
  <div class="container" style="max-width: 1200px;">
    <div class="mb-4 animate-fade-in-up">
      {% if request.user.language == 'kk' %}
        <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; letter-spacing: -0.02em;">Қолдау дашборды</h1>
        <p style="color: var(--kt-text-light); margin: 0;">Жүктеме, автоматтандыру және жауап беру жылдамдығы</p>
      {% else %}
        <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; letter-spacing: -0.02em;">Дашборд поддержки</h1>
        <p style="color: var(--kt-text-light); margin: 0;">Обзор нагрузки, автоматизации и скорости реакции</p>
      {% endif %}
    </div>

    <div class="row g-4 mb-4">
      <div class="col-md-4">
        <div class="stripe-card text-center animate-fade-in-up" style="animation-delay: 0.1s;">
          <div style="font-size: 0.875rem; font-weight: 600; color: var(--kt-text-light); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem;">
            {% if request.user.language == 'kk' %}Барлық өтінімдер{% else %}Всего заявок{% endif %}
          </div>
          <div style="font-size: 3rem; font-weight: 700; color: var(--kt-primary); letter-spacing: -0.02em;">{{ total_tickets }}</div>
          <div style="font-size: 0.875rem; color: var(--kt-text-light); margin-top: 0.5rem;">{% if request.user.language == 'kk' %}Барлық уақыт бойынша{% else %}За всё время{% endif %}</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stripe-card text-center animate-fade-in-up" style="animation-delay: 0.2s;">
          <div style="font-size: 0.875rem; font-weight: 600; color: var(--kt-text-light); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem;">
            {% if request.user.language == 'kk' %}Автоматты шешімдер{% else %}Авто-решение{% endif %}
          </div>
          <div style="font-size: 3rem; font-weight: 700; color: var(--kt-accent); letter-spacing: -0.02em;">{{ auto_solved_percent }}%</div>
          <div style="font-size: 0.875rem; color: var(--kt-text-light); margin-top: 0.5rem;">{% if request.user.language == 'kk' %}AI арқылы жабылған өтінімдердің үлесі{% else %}Доля обращений, закрытых AI{% endif %}</div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stripe-card text-center animate-fade-in-up" style="animation-delay: 0.3s;">
          <div style="font-size: 0.875rem; font-weight: 600; color: var(--kt-text-light); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem;">
            {% if request.user.language == 'kk' %}Орташа уақыт{% else %}Среднее время{% endif %}
          </div>
          <div style="font-size: 3rem; font-weight: 700; color: var(--kt-primary); letter-spacing: -0.02em;">{{ avg_response_time_seconds }}<span style="font-size: 1.5rem; color: var(--kt-text-light);">с</span></div>
          <div style="font-size: 0.875rem; color: var(--kt-text-light); margin-top: 0.5rem;">{% if request.user.language == 'kk' %}Боттың алғашқы жауабының уақыты{% else %}До первого ответа бота{% endif %}</div>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <div class="col-lg-8">
        <div class="stripe-card animate-fade-in-up" style="animation-delay: 0.4s;">
          <div class="d-flex justify-content-between align-items-center mb-2">
            {% if request.user.language == 'kk' %}
              <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0;">Санаттар бойынша бөлу</h2>
              <span style="font-size: 0.875rem; color: var(--kt-text-light);">тикеттер саны бойынша</span>
            {% else %}
              <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0;">Распределение по категориям</h2>
              <span style="font-size: 0.875rem; color: var(--kt-text-light);">по количеству тикетов</span>
            {% endif %}
          </div>
          <canvas id="ticketsByCategory" height="110"></canvas>
          <div style="margin-top: 1rem; font-size: 0.875rem; color: var(--kt-text-light);">
            <i class="bi bi-info-circle me-1"></i>
            {% if request.user.language == 'kk' %}
              Баған қаншалықты биік болса, сәйкес каналдағы (Интернет, ТВ, биллинг және т.б.) жүктеме соғұрлым жоғары
            {% else %}
              Чем выше столбец, тем больше нагрузка на соответствующий канал (Интернет, ТВ, биллинг и т.д.)
            {% endif %}
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="stripe-card animate-fade-in-up" style="animation-delay: 0.5s;">
          <h2 style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            <i class="bi bi-lightbulb" style="color: var(--kt-accent);"></i>
            {% if request.user.language == 'kk' %}Қысқаша қорытындылар{% else %}Краткие выводы{% endif %}
          </h2>
          <ul style="list-style: none; padding: 0; margin: 0; font-size: 0.9rem; color: var(--kt-text-light); display: flex; flex-direction: column; gap: 0.75rem;">
            <li>
              <strong style="color: var(--kt-text);">{% if request.user.language == 'kk' %}Жүктеме:{% else %}Нагрузка:{% endif %}</strong>
              <br>{% if request.user.language == 'kk' %}Негізгі өтінімдер көлемі баған биік тұрған санаттарда шоғырланған.{% else %}Основной объём обращений сконцентрирован в категориях, где высота столбцов максимальна.{% endif %}
            </li>
            <li>
              <strong style="color: var(--kt-text);">{% if request.user.language == 'kk' %}Автоматтандыру:{% else %}Автоматизация:{% endif %}</strong>
              <br>{% if request.user.language == 'kk' %}Автоматты шешімдер үлесі 50%+ болғанда, пик уақыттарда операторларға түсетін жүктемені азайтуға болады.{% else %}При авто-решении &gt; 50% можно снижать нагрузку на операторов в пиковые часы.{% endif %}
            </li>
            <li>
              <strong style="color: var(--kt-text);">{% if request.user.language == 'kk' %}Жауап жылдамдығы:{% else %}Скорость ответа:{% endif %}</strong>
              <br>{% if request.user.language == 'kk' %}Алғашқы жауап беру уақыты 10 секундтан аз болса, клиент үшін қолайлы деп есептеледі.{% else %}Среднее время до первого ответа &lt; 10 секунд считается комфортным для клиента.{% endif %}
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
  (function() {
    const ctx = document.getElementById('ticketsByCategory');
    if (!ctx) return;
    const data = {
      labels: [{% for row in by_category %}'{{ row.category }}'{% if not forloop.last %},{% endif %}{% endfor %}],
      datasets: [{
        label: 'Тикеты',
        data: [{% for row in by_category %}{{ row.count }}{% if not forloop.last %},{% endif %}{% endfor %}],
        backgroundColor: '#00AEEF',
        borderRadius: 8,
        borderSkipped: false,
      }]
    };
    new Chart(ctx, {
      type: 'bar',
      data: data,
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: { 
          legend: { display: false },
          tooltip: {
            backgroundColor: '#0a2540',
            padding: 12,
            titleFont: { size: 14, weight: '600' },
            bodyFont: { size: 13 },
            borderColor: '#e3e8ef',
            borderWidth: 1
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              color: '#e3e8ef',
              drawBorder: false
            },
            ticks: {
              font: { size: 12 },
              color: '#425466'
            }
          },
          x: {
            grid: {
              display: false
            },
            ticks: {
              font: { size: 12, weight: '500' },
              color: '#0a2540'
            }
          }
        }
      }
    });
  })();
</script>
{% endblock %}
